<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sugar Kane Rhythm Game</title>
  <style>
    body {
      margin: 0;
      background: black;
      overflow: hidden;
      font-family: monospace;
    }
    canvas {
      background: #111;
      display: block;
      margin: auto;
      margin-top: 30px;
    }
    .ui {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(0,0,0,0.5);
      padding: 10px;
      border-radius: 6px;
      color: white;
    }
    .ui input, .ui textarea {
      width: 120px;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="600" height="700"></canvas>
  <div class="ui">
    <label>Volume:</label>
    <input type="range" id="volume" min="0" max="1" step="0.01" value="0.5"><br>
    <label>Judge:</label>
    <input type="range" id="judge" min="10" max="150" value="50"><br>
    <button onclick="togglePause()">‚è∏ Pause</button><br>
    <textarea id="commentBox" placeholder="Leave comment..."></textarea><br>
    <button onclick="saveComment()">üí¨ Save</button>
  </div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const volumeSlider = document.getElementById("volume");
    const judgeSlider = document.getElementById("judge");

    let isPaused = false;
    let startTime = null;
    const speed = 300; // pixels per second
    const hitLineY = canvas.height - 100;
    const notes = [];

    const keys = ['a', 's', 'd', 'k', 'l'];
    const keyPositions = {
      'a': 100, 's': 180, 'd': 260, 'k': 340, 'l': 420
    };

    // Generate some notes for demo
    for (let i = 0; i < 50; i++) {
      const time = 1.5 + i * 0.6;
      const key = keys[i % keys.length];
      notes.push({ time, key, hit: false });
    }

    const hitSound = new Audio();
    hitSound.src = "data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAIlYAAESsAAACABAAZGF0YRAAAAAA"; // short click sound
    hitSound.volume = volumeSlider.value;

    volumeSlider.addEventListener("input", () => {
      hitSound.volume = volumeSlider.value;
    });

    function togglePause() {
      isPaused = !isPaused;
    }

    function saveComment() {
      const c = document.getElementById("commentBox").value;
      if (c.trim()) {
        localStorage.setItem("sugarKaneComment", c);
        alert("Comment saved!");
      }
    }

    document.addEventListener("keydown", (e) => {
      const currentTime = (performance.now() - startTime) / 1000;
      const judge = parseInt(judgeSlider.value);

      notes.forEach(note => {
        if (!note.hit && note.key === e.key) {
          const y = (note.time - currentTime) * speed;
          if (Math.abs(y - hitLineY) < judge) {
            note.hit = true;
            hitSound.currentTime = 0;
            hitSound.play();
            console.log("HIT!");
          }
        }
      });
    });

    function drawHitLine() {
      ctx.strokeStyle = "gray";
      ctx.beginPath();
      ctx.moveTo(0, hitLineY);
      ctx.lineTo(canvas.width, hitLineY);
      ctx.stroke();

      keys.forEach(k => {
        ctx.fillStyle = "white";
        ctx.fillRect(keyPositions[k], hitLineY, 40, 10);
      });
    }

    function drawNotes(currentTime) {
      notes.forEach(note => {
        if (note.hit) return;
        const x = keyPositions[note.key];
        const y = (note.time - currentTime) * speed;

        if (y > -20 && y < canvas.height) {
          ctx.fillStyle = "lime";
          ctx.fillRect(x, y, 40, 15);
          note.y = y;
        }
      });
    }

    function gameLoop(timestamp) {
      if (!startTime) startTime = timestamp;
      const currentTime = (timestamp - startTime) / 1000;

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      if (!isPaused) {
        drawHitLine();
        drawNotes(currentTime);
      }

      requestAnimationFrame(gameLoop);
    }

    requestAnimationFrame(gameLoop);
  </script>
</body>
</html>



